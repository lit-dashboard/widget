var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).webbit=t()}(this,(function(){"use strict";const e=new RegExp("^[a-z]+(([0-9])|([A-Z0-9][a-z0-9]+))*([A-Z])?$"),t=new RegExp("^([a-z][a-z0-9]*)(-[a-z0-9]+)*$"),r=new RegExp("^(String|Boolean|Number|Array|Object)$"),s=e=>e instanceof Object&&null!==e&&"Source"===e.constructor.__WEBBIT_CLASSNAME__,n=e=>"string"==typeof e?"String":"number"==typeof e?"Number":"boolean"==typeof e?"Boolean":e instanceof Array?"Array":e instanceof Object?"Object":null,o=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return!1},i=e=>!1===e?e:((e,r)=>{if("string"!=typeof e||!t.test(e))throw new Error(`The ${r} must be a string written in kebab case.`);return e})(e,"property's attribute"),u=t=>((t,r)=>{if("string"!=typeof t||!e.test(t))throw new Error(`The ${r} must be a string written in camel case.`);return t})(t,"property's name"),c=e=>"string"==typeof e?e:"",a=e=>((e,t)=>{if("string"!=typeof name||!r.test(e))throw new Error((e=>`The ${e} must be a string with value 'String', 'Number', 'Boolean', 'Array' or 'Object'.`)(t));return e})(e,"property's type"),l=(e,t)=>{const r=void 0===t?(e=>({String:"",Number:0,Boolean:!1,Array:[],Object:{}}[e]))(e):t;if(!((e,t)=>{switch(e){case"String":return"string"==typeof t;case"Number":return"number"==typeof t;case"Boolean":return"boolean"==typeof t;case"Array":return t instanceof Array;case"Object":return t instanceof Object}return!1})(e,r))throw new Error("The property's default value does not match its type.");return r},p=(e,t)=>{if(!1===e)return e;if("string"!=typeof e)throw new Error(t);return e},h=e=>p(e,"changeEvent must be false or a string"),f=({description:e="",defaultSourceKey:t=!1,defaultSourceProvider:r=!1,properties:s={},events:n=[],slots:o=[],cssProperties:f=[],cssParts:d=[]}={})=>{return{description:c(e),defaultSourceKey:(y=t,p(y,"defaultSourceKey must be false or a string")),defaultSourceProvider:(b=r,p(b,"defaultSourceProvider must be false or a string")),properties:Object.fromEntries(Object.entries(s).map((([e,t])=>((e,{description:t="",type:r="String",defaultValue:s,attribute:n=!1,reflect:o=!1,primary:p=!1,changeEvent:f=!1}={})=>{const d=a(r),b=l(d,s);return[u(e),{description:c(t),type:d,defaultValue:b,attribute:i(n),reflect:!!o,primary:!!p,changeEvent:h(f)}]})(e,t)))),events:n,slots:o,cssProperties:f,cssParts:d};var b,y};class d{static prop2PropValue(e){if(null===e)return null;if(e instanceof Array)return e;if("string"==typeof e)try{const t=JSON.parse(e);return t instanceof Array?t:[]}catch(t){return[]}return[]}static prop2AttrValue(e){const t=d.prop2PropValue(e);return null===t?null:JSON.stringify(t)}static attr2PropValue(e){if(null===e)return null;try{const t=JSON.parse(e);return t instanceof Array?t:[]}catch(t){return[]}}}class b{static prop2PropValue(e){if(null===e)return null;if(e instanceof Object)return e;if("string"==typeof e)try{const t=JSON.parse(e);return t instanceof Object?t:{}}catch(t){return{}}return{}}static prop2AttrValue(e){const t=b.prop2PropValue(e);return null===t?null:JSON.stringify(t)}static attr2PropValue(e){if(null===e)return null;try{const t=JSON.parse(e);return t instanceof Object?t:{}}catch(t){return{}}}}const y={Array:d,Boolean:class{static prop2PropValue(e){return null===e?null:!!e}static prop2AttrValue(e){return e?"":null}static attr2PropValue(e){return null!==e}},Number:class{static prop2PropValue(e){return null===e?null:parseFloat(e)}static prop2AttrValue(e){return null===e?null:parseFloat(e).toString()}static attr2PropValue(e,t){return null===e?null:parseFloat(e)}},Object:b,String:class{static prop2PropValue(e){return null===e?null:(null==e?void 0:e.toString())||""}static prop2AttrValue(e){return null===e?null:(null==e?void 0:e.toString())||""}static attr2PropValue(e,t){return null===e?null:e}}},_=(e,t)=>y[t].prop2PropValue(e),g=(e,t)=>y[t].attr2PropValue(e);class m{get value(){const{reflect:e,attribute:t,name:r,type:s}=this._property;return t&&e?g(this._element.getAttribute(t),s):r in this._element?this._element[r]:g(this._element.getAttribute(t),s)}set value(e){const{attribute:t,name:r,type:s}=this._property,i=n(e),u=this.value;if(!o(_(u,i),e))if(t){const r=((e,t)=>y[t].prop2AttrValue(e))(e,s),n=g(r,i);o(e,n)&&(null===r?this._element.removeAttribute(t):this._element.setAttribute(t,r))}else{const t=_(e,s),n=_(t,i);o(e,n)&&(this._element[r]=t)}}constructor(e,t){this._element=e,this._property=t,this._connected=!1,this._defaultValue=this._property.defaultValue,this._subscribers=[],this._propertyObserver=this._getPropertyObserver()}_getPropertyObserver(){const{changeEvent:e,attribute:t}=this._property;if(e){const t=()=>{this._notifySubscribers()};return{connect:()=>{this._element.addEventListener(e,t,!1)},disconnect:()=>{this._element.removeEventListener(e,t,!1)}}}if(t){const e=new MutationObserver((()=>{this._notifySubscribers()}));return{connect:()=>{e.observe(this._element,{attributes:!0,attributeFilter:[t]})},disconnect:()=>{e.disconnect()}}}return{connect(){},disconnect(){}}}connect(){if(!this._connected){const e=this.value;this._defaultValue=void 0!==e?e:this._property.defaultValue,this._propertyObserver.connect(),this._connected=!0}}disconnect(){this._connected&&(this._connected=!1,this._propertyObserver.disconnect(),this._setToDefault())}update(e){this.connect(),this.value=e}subscribe(e){this._subscribers.push(e)}_notifySubscribers(){const e=this.value;this._subscribers.forEach((t=>{t(e)}))}_setToDefault(){this.value=this._defaultValue}}return class{get sourceProvider(){return this.element.getAttribute("source-provider")}get sourceKey(){return this.element.getAttribute("source-key")}set sourceProvider(e){e&&this.element.setAttribute("source-provider",e)}set sourceKey(e){e&&this.element.setAttribute("source-key",e)}get source(){return this.store.getSource(this.sourceProvider,this.sourceKey)}get hasSource(){return void 0!==this.store.getRawSource(this.sourceProvider,this.sourceKey)}constructor(e,t,r){this.element=e,this.store=t,this.config=f(r||{name:e.tagName.toLowerCase()});const s=Object.entries(this.config.properties).map((([e,t])=>__spreadProps(__spreadValues({},t),{name:e})));this.propertyHandlers=new Map(s.map((e=>{const t=new m(this.element,e);return t.subscribe((t=>{this._onPropertyUpdate(e,t)})),[e.name,t]}))),this.primaryPropertyConfig=s.find((({primary:e})=>e)),this.primaryPropertyHandler=this.primaryPropertyConfig?this.propertyHandlers.get(this.primaryPropertyConfig.name):null,this._connected=!1,this._sourceChangeObserver=this._getSourceChangeObserver(),this.defaultPropertyValues={},this._unsubscribe=()=>{},this.store.defaultSourceProviderSet((e=>{null===this.sourceProvider&&(this.sourceProvider=e)})),this.connect()}_getSourceChangeObserver(){const e=new MutationObserver((()=>{this._updateSubscription()}));return{connect:()=>{e.observe(this.element,{attributes:!0,attributeFilter:["source-provider","source-key"]})},disconnect:()=>{e.disconnect()}}}connect(){this._connected=!0,this._sourceChangeObserver.connect(),this._updateSubscription()}disconnect(){this._connected=!1,this._sourceChangeObserver.disconnect(),this._updateSubscription()}_updateSubscription(){if(!this._connected)return this._unsubscribe(),this._unsubscribe=()=>{},void this.propertyHandlers.forEach((e=>e.disconnect()));this.sourceKey||(this.sourceKey=this.config.defaultSourceKey),this.sourceProvider||(this.sourceProvider=this.config.defaultSourceProvider||this.store.getDefaultSourceProvider()),this.sourceKey&&this.sourceProvider?(this._unsubscribe(),this.propertyHandlers.forEach((e=>{e.disconnect()})),this._unsubscribe=this.store.subscribe(this.sourceProvider,this.sourceKey,((e,t,r)=>{this._subscriber(e,t,r)}),!0)):(this._unsubscribe(),this._unsubscribe=()=>{},this.propertyHandlers.forEach((e=>e.disconnect())))}_subscriber(e,t,r){if(void 0===e)this.propertyHandlers.forEach((e=>{e.disconnect()}));else if(s(e))if(t===r)Object.getOwnPropertyNames(e).forEach((t=>{this.propertyHandlers.has(t)&&this.propertyHandlers.get(t).update(e[t])}));else{const s=r.replace(t+"/","");if(this.propertyHandlers.has(s)){const t=this.propertyHandlers.get(s),r=e[s];void 0===r?t.disconnect():t.update(r)}}else this.primaryPropertyHandler&&this.primaryPropertyHandler.update(e)}_onPropertyUpdate({name:e,primary:t},r){const i=this.source,u=this.store.getSourceProvider(this.sourceProvider),c=n(r);if(!s(i)&&t)if(null===r)null!==i&&u.userUpdate(this.sourceKey,r);else{const e=n(i)||c,t=_(r,e),s=_(t,c);o(r,s)&&!o(i,t)&&u.userUpdate(this.sourceKey,t)}if(null===r)null!==i[e]&&(i[e]=r);else{const t=n(i[e])||c,s=_(r,t),u=_(s,c);o(r,u)&&!o(i[e],s)&&(i[e]=s)}}}}));
