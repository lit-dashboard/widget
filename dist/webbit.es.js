const e=new RegExp("^[a-z]+(([0-9])|([A-Z0-9][a-z0-9]+))*([A-Z])?$"),t=new RegExp("^([a-z][a-z0-9]*)(-[a-z0-9]+)*$"),r=new RegExp("^(String|Boolean|Number|Array|Object)$"),s=(e,r)=>{if("string"!=typeof e||!t.test(e))throw new Error(`The ${r} must be a string written in kebab case.`);return e};var n,i,o=Function.prototype,c=Object.prototype,u=o.toString,a=c.hasOwnProperty,h=u.call(Object),p=c.toString,l=(n=Object.getPrototypeOf,i=Object,function(e){return n(i(e))});function f(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=p.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}(e))return!1;var t=l(e);if(null===t)return!0;var r=a.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&u.call(r)==h}const b=e=>e instanceof Object&&null!==e&&"Source"===e.constructor.__WEBBIT_CLASSNAME__,y=(e,t,r)=>{e.getAttribute(t)!=r&&e.setAttribute(t,r)},d=(e,t)=>{e.hasAttribute(t)&&e.removeAttribute(t)},g=(e,t,r)=>{const s=e.getAttribute(t);return"Boolean"===r?null!==s:((e,t)=>{switch(t){case"String":return(null==e?void 0:e.toString())||"";case"Number":const t=parseFloat(e);return isNaN(t)?0:t;case"Boolean":return!!e;case"Array":if(e instanceof Array)return e;if("string"!=typeof e)return[];try{const t=JSON.parse(e);return t instanceof Array?t:[]}catch(r){return[]}case"Object":if(f(e))return e;try{return JSON.parse(e)}catch(r){return{}}default:return""}})(s,r)},_=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(e instanceof Array&&t instanceof Array){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return!1},v=e=>s(e,"element name"),m=e=>!1===e?e:s(e,"property's attribute"),S=t=>((t,r)=>{if("string"!=typeof t||!e.test(t))throw new Error(`The ${r} must be a string written in camel case.`);return t})(t,"property's name"),P=e=>"string"==typeof e?e:"",O=e=>((e,t)=>{if("string"!=typeof name||!r.test(e))throw new Error((e=>`The ${e} must be a string with value 'String', 'Number', 'Boolean', 'Array' or 'Object'.`)(t));return e})(e,"property's type"),w=(e,t)=>{const r=void 0===t?(e=>({String:"",Number:0,Boolean:!1,Array:[],Object:{}}[e]))(e):t;if(!((e,t)=>{switch(e){case"String":return"string"==typeof t;case"Number":return"number"==typeof t;case"Boolean":return"boolean"==typeof t;case"Array":return t instanceof Array;case"Object":return f(t)}return!1})(e,r))throw new Error("The property's default value does not match its type.");return r},A=(e,t)=>{if(!1===e)return e;if("string"!=typeof e)throw new Error(t);return e},E=e=>A(e,"changeEvent must be false or a string"),j=({name:e,description:t="",type:r="String",defaultValue:s,attribute:n=!1,reflect:i=!1,primary:o=!1,changeEvent:c=!1}={})=>{const u=O(r),a=w(u,s);return{name:S(e),description:P(t),type:u,defaultValue:a,attribute:m(n),reflect:!!i,primary:!!o,changeEvent:E(c)}};class N{get value(){const{reflect:e,attribute:t,name:r,type:s}=this._property;return t&&e?g(this._element,t,s):r in this._element?this._element[r]:g(this._element,t,s)}set value(e){const{attribute:t,name:r}=this._property;t?((e,t,r)=>{"string"==typeof r?y(e,t,r):"number"==typeof r?isNaN(r)?d(e,t):y(e,t,r):"boolean"==typeof r?r?y(e,t,""):d(e,t):(r instanceof Array||r instanceof Object)&&y(e,t,JSON.stringify(r))})(this._element,t,e):_(this._element[r],e)||(this._element[r]=e)}constructor(e,t){this._element=e,this._property=t,this._connected=!1,this._defaultValue=this._property.defaultValue,this._subscribers=[],this._propertyObserver=this._getPropertyObserver()}_getPropertyObserver(){const{changeEvent:e,attribute:t}=this._property;if(e){const t=()=>{this._notifySubscribers()};return{connect:()=>{this._element.addEventListener(e,t,!1)},disconnect:()=>{this._element.removeEventListener(e,t,!1)}}}if(t){const e=new MutationObserver((()=>{this._notifySubscribers()}));return{connect:()=>{e.observe(this._element,{attributes:!0,attributeFilter:[t]})},disconnect:()=>{e.disconnect()}}}return{connect(){},disconnect(){}}}connect(){if(!this._connected){const e=this.value;this._defaultValue=void 0!==e?e:this._property.defaultValue,this._propertyObserver.connect(),this._connected=!0}}disconnect(){this._connected&&(this._connected=!1,this._propertyObserver.disconnect(),this._setToDefault())}update(e){this.connect(),this.value=e}subscribe(e){this._subscribers.push(e)}_notifySubscribers(){const e=this.value;this._subscribers.forEach((t=>{t(e)}))}_setToDefault(){this.value=this._defaultValue}}export default class{get sourceProvider(){return this.element.getAttribute("source-provider")}get sourceKey(){return this.element.getAttribute("source-key")}set sourceProvider(e){e&&this.element.setAttribute("source-provider",e)}set sourceKey(e){e&&this.element.setAttribute("source-key",e)}get source(){return this.store.getSource(this.sourceProvider,this.sourceKey)}get hasSource(){return void 0!==this.store.getRawSource(this.sourceProvider,this.sourceKey)}constructor(e,t,r){this.element=e,this.store=t,this.config=(({name:e,description:t="",defaultSourceKey:r=!1,defaultSourceProvider:s=!1,properties:n=[],events:i=[],slots:o=[],cssProperties:c=[],cssParts:u=[]}={})=>{return{name:v(e),description:P(t),defaultSourceKey:(h=r,A(h,"defaultSourceKey must be false or a string")),defaultSourceProvider:(a=s,A(a,"defaultSourceProvider must be false or a string")),properties:n.map(j),events:i,slots:o,cssProperties:c,cssParts:u};var a,h})(r||{name:e.tagName.toLowerCase()}),this.propertyHandlers=new Map(this.config.properties.map((e=>{const t=new N(this.element,e);return t.subscribe((t=>{this._onPropertyUpdate(e,t)})),[e.name,t]}))),this.primaryPropertyConfig=this.config.properties.find((({primary:e})=>e)),this.primaryPropertyHandler=this.primaryPropertyConfig?this.propertyHandlers.get(this.primaryPropertyConfig.name):null,this._connected=!1,this._sourceChangeObserver=this._getSourceChangeObserver(),this.defaultPropertyValues={},this._unsubscribe=()=>{},this.store.defaultSourceProviderSet((e=>{null===this.sourceProvider&&(this.sourceProvider=e)})),this.connect()}_getSourceChangeObserver(){const e=new MutationObserver((()=>{this._updateSubscription()}));return{connect:()=>{e.observe(this.element,{attributes:!0,attributeFilter:["source-provider","source-key"]})},disconnect:()=>{e.disconnect()}}}connect(){this._connected=!0,this._sourceChangeObserver.connect(),this._updateSubscription()}disconnect(){this._connected=!1,this._sourceChangeObserver.disconnect(),this._updateSubscription()}_updateSubscription(){if(!this._connected)return this._unsubscribe(),this._unsubscribe=()=>{},void this.propertyHandlers.forEach((e=>e.disconnect()));this.sourceKey||(this.sourceKey=this.config.defaultSourceKey),this.sourceProvider||(this.sourceProvider=this.config.defaultSourceProvider||this.store.getDefaultSourceProvider()),this.sourceKey&&this.sourceProvider?(this._unsubscribe(),this.propertyHandlers.forEach((e=>{e.disconnect()})),this._unsubscribe=this.store.subscribe(this.sourceProvider,this.sourceKey,((e,t,r)=>{this._subscriber(e,t,r)}))):(this._unsubscribe(),this._unsubscribe=()=>{},this.propertyHandlers.forEach((e=>e.disconnect())))}_subscriber(e,t,r){if(void 0===e)this.propertyHandlers.forEach((e=>{e.disconnect()}));else if(b(e))if(t===r)Object.getOwnPropertyNames(e).forEach((t=>{this.propertyHandlers.has(t)&&this.propertyHandlers.get(t).update(e[t])}));else{const s=r.replace(t+"/","");if(this.propertyHandlers.has(s)){const t=this.propertyHandlers.get(s),r=e[s];void 0===r?t.disconnect():t.update(r)}}else this.primaryPropertyHandler&&this.primaryPropertyHandler.update(e)}_onPropertyUpdate({name:e,primary:t},r){const s=this.source;if(b(s))_(s[e],r)||(s[e]=r);else if(t&&!_(s,r)){this.store.getSourceProvider(this.sourceProvider).userUpdate(`${this.sourceKey}/${e}`,r)}}}
